stages:
- stage: Testing
  jobs:
  - job: DAST
    displayName: DAST with OWASP ZAP
    steps:
    - task: CmdLine@2
      displayName: Prepare networking
      inputs:
        script: |
          docker network create --subnet=172.20.0.0/24 demo-network
        failOnStderr: true
    - task: CmdLine@2
      displayName: Build Application container
      inputs:
        script: |
          docker build -t python-devsecops-demo .
        failOnStderr: true

    - task: CmdLine@2
      displayName: Run Application container
      inputs:
        script: |
          docker run -it -p 8181:8181 --net demo-network --ip 172.20.0.10 python-devsecops-demo
          
    - task: CmdLine@2
      displayName: Run ZAP container
      inputs:
        script: |
          docker run -t --net demo-network owasp/zap2docker-stable:2.11.0 zap-full-scan.py -t http://172.20.0.10:8181
        failOnStderr: false

#         repository: 'georgesbolssenstoreon/vulnerable-python-demo-dockerhub-repo'